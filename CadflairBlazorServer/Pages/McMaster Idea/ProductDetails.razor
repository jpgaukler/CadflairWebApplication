@using Row = CadflairDataAccess.Models.Row;

@page "/{CompanyName}/products/{ProductDefinitionName}/{PartNumber}"
@layout ConfiguratorLayout

<PageTitle>@CompanyName - Categories</PageTitle>

<MudStack Class="mud-height-full px-5 pt-3 overflow-auto relative">
    <MudOverlay Visible="_initializing" Absolute Class="mud-background">
        <MudProgressCircular Color="Color.Default" Size="Size.Large" Indeterminate />
    </MudOverlay>

    <MudStack Spacing="0" Class="mb-5">
        <MudText Typo="Typo.h4">@_productDefinition?.Name</MudText>
        <MudText Typo="Typo.body1">Part Number: @_row.PartNumber</MudText>
    </MudStack>

    <MudGrid>
        <MudItem xs="6">
            <MudPaper Class="relative" MinHeight="50dvh" Height="100%" MaxHeight="65dvh">
                <ForgeViewer @ref="_forgeViewer" />
                @*<MudButton StartIcon="@Icons.Material.Filled.RemoveRedEye" OnClick="PreviewAttachment_OnClick">Preview</MudButton>*@
            </MudPaper>
        </MudItem>

        <MudItem xs="6">
            <!-- product details -->
            @if (_row.Attachments.Any() == true)
            {
                <MudText Typo="Typo.body2">Downloads</MudText>
                <MudStack Row AlignItems="AlignItems.Center">
                    <MudIcon Icon="@Icons.Material.Filled.InsertDriveFile" />
                    <MudSelect T="Attachment" Value="_selectedAttachment" ValueChanged="Attachment_ValueChanged" Variant="Variant.Outlined" Margin="Margin.Dense" AnchorOrigin="Origin.BottomCenter">
                        @foreach (var attachment in _row.Attachments)
                        {
                            <MudSelectItem Value="attachment">@attachment.ForgeObjectKey</MudSelectItem>
                        }
                    </MudSelect>
                    <MudButton StartIcon="@Icons.Material.Filled.Download" OnClick="Download_OnClick" Variant="Variant.Filled">Download</MudButton>
                </MudStack>
            }
            <MudTable Items="_row.TableValues" Elevation="0" Class="my-5">
                <RowTemplate>
                    <MudTd>@_productTable.Columns.FirstOrDefault(i => i.Id == context.ColumnId)?.Header</MudTd>
                    <MudTd>@context.Value</MudTd>
                </RowTemplate>
            </MudTable>
            <MudText Typo="Typo.body1" Class="mt-5">@_productDefinition?.Description</MudText>
        </MudItem>
    </MudGrid>
</MudStack>


